<style>
    .bg-canvas{
        background-color:#EFF0F6!important
    }

    @font-face {
        font-family: "CPN-Regular";
        src: url('./font/CPN-Regular.ttf');
    }
    @font-face {
        font-family: "CPN-Bold";
        src: url('./font/CPN-Bold.ttf');
    }

    body{
        background-color:#EFF0F6!important;
        font-size:12px;
        /* font-family: 'IBM Plex Sans Thai', sans-serif!important; */
        font-family: 'CPN-Regular';
    }
    .f-cpn-bold{
        font-family: 'CPN-Bold'!important;
    }
    .header-product-grouping{
        font-family: 'CPN';
        font-style: normal;
        font-weight: 700;
        font-size: 24px;
        line-height: 38px;
    }
    .breadcrumb-item.select{
        font-family: 'CPN';
        font-style: normal;
        font-weight: 700;
        font-size: 12px;
        line-height: 19px;
        color: #A6192E;

    }

    .breadcrumb-item{
        font-family: 'CPN';
        font-style: normal;
        font-weight: 700;
        font-size: 12px;
        line-height: 19px;

    }

    .input-parent-convert{
        width: 100%;
        background: #FFFFFF;
        border-radius: 5px;
        border:0px;
        margin:0px;
        padding-left: 5px;
        padding-right: 5px;
        color: #787878;
        font-weight: 500;


    }

    .col-input-parent-convert{
        flex: 1 0 1%;
        max-width: 68px!important;
        margin-right:1px;
        margin-left:0px;
        height: 27px;
        padding-right: 5px!important;
        padding-left:5px!important;
    }

    .form-label{
        font-style: normal;
        font-weight: 700;
        font-size: 12px;
        /* line-height: 19px; */
        /* identical to box height */
        color: #6E7191;

    }
    .preview-parent{
        font-style: normal;
        font-weight: 400;
        font-size: 12px;
        line-height: 19px;
        /* identical to box height */
        color: #A2A2A2;
    }

    .form-check .form-check-input {
    float: left;
    /* margin-left: -1.5em!important; */
    width: 61px!important;
    height: 31px!important;
    margin-right: 10px;
    color: #6E7191;
    }

small.form-check-label{
    display: block;
    color: #6E7191;
    margin-left: 30px;
}

label.form-check-label{
    display: -webkit-inline-box;
    color: #6E7191;
    /* font-family: 'CPN-Bold'; */
}

.form-check-input:checked {
    background-color: #4CAF50!important;
    border-color: #4CAF50!important;
}

.form-check-label.warning{
    font-size: 12px;
    color: #FF9800;
    margin-left: 30px;
}

.form-check-label.header{
    color: #6E7191;
    font-weight:500;
}


</style>


<div id="nav_choose_file">
    <div class="nav_input">
        <div class="box_input p-3 shadow-sm border-bottom bg-white">
            <input type="file" id="linesheet_input" accept=".xlsx, .xlsm" onchange="handleFileChange()"/>
        </div>
    </div>

</div>
<div class="row h-100">
    <div class="col-6 border-end">
        <div class="bg-canvas ps-5 ">
            <!-- breadcrumb -->
            <nav aria-label="breadcrumb" style="--bs-breadcrumb-divider: '>';" class=" pt-5 f-cpn-bold" >
                <ol class="breadcrumb">
                    <li class="breadcrumb-item ">Import</li>
                    <li class="breadcrumb-item ">Linesheet validate</li>
                    <li class="breadcrumb-item ">Cleansing</li>
                    <li class="breadcrumb-item select" aria-current="page">Convert</li>
                </ol>
            </nav>


            <!-- header -->
            <div style="font:24px;" class="header-product-grouping">Product grouping</div>
            <small>
                First number of running grouping
            </small>
            <!-- grouping input -->
            <div class="mt-3 row ps-2" style="height: 60px;">

                <div class="col-input-parent-convert">
                    <label for="prefix"  class="form-label">Prefix</label>
                    <input type="text" onchange="summary_parent_sku_range()" class="input-parent-convert" id="parent_prefix">
                </div>

                <div class="col-input-parent-convert">
                    <label for="prefix" class="form-label">BU</label>
                    <input type="text" onchange="summary_parent_sku_range()" class="input-parent-convert" id="parent_bu">
                </div>

                <div class="col-input-parent-convert">
                    <label for="prefix" class="form-label">User ID</label>
                    <input type="text" onchange="summary_parent_sku_range()" class="input-parent-convert" id="parent_us_id">
                </div>

                <div class="col-input-parent-convert">
                    <label for="prefix" class="form-label">Year</label>
                    <input type="text" onchange="summary_parent_sku_range()" class="input-parent-convert" id="parent_year">
                </div>

                <div class="col-input-parent-convert">
                    <label for="prefix" class="form-label">Month</label>
                    <input type="text" onchange="summary_parent_sku_range()" class="input-parent-convert" id="parent_month">
                </div>

                <div class="col-input-parent-convert">
                    <label for="prefix" class="form-label">Running</label>
                    <input type="text" onchange="summary_parent_sku_range()" class="input-parent-convert" id="parent_running">
                </div>
            </div>

            <small class="preview-parent">Preview : <span id="preview_parent_start"></span> - <span id="preview_parent_end">parent_1</span> (<span id="preview_parent_lenght">N</span> SKUs) </small>
            <hr>
            <div style="font:24px;" class="header-product-grouping">Product configurable</div>
            <small>
                Apply setting below to all product
            </small>
            <div class="row mt-3">
                <div class="col-6">
                    <div class="form-check form-switch m-2 mb-4">
                        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                        <label class="form-check-label header" for="flexSwitchCheckDefault">Product online</label>
                        <small class="form-check-label" for="flexSwitchCheckDefault">Set status of product as default</small>
                    </div>
                    <div class="form-check form-switch m-2 mb-4">
                        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                        <label class="form-check-label header" for="flexSwitchCheckDefault">Allow CC</label>
                        <small class="form-check-label" for="flexSwitchCheckDefault">Allow product to click and correct</small>
                    </div>
                    <div class="form-check form-switch m-2 mb-4">
                        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                        <label class="form-check-label header" for="flexSwitchCheckDefault">Allow COD</label>
                        <small class="form-check-label" for="flexSwitchCheckDefault">Allow product to show cash on delivery badge</small>
                        <small class="form-check-label warning" for="flexSwitchCheckDefault"><ion-icon name="warning-outline"></ion-icon>Only product price more than 7000 able to COD</small>
                    </div>
                    <div class="form-check form-switch m-2 mb-4">
                        <input class="form-check-input" checked type="checkbox" role="switch" id="flexSwitchCheckDefault">
                        <label class="form-check-label header" for="flexSwitchCheckDefault">New</label>
                        <small class="form-check-label" for="flexSwitchCheckDefault">Mark product is new, new badge will show on product card PLP and PDP</small>
                    </div>
                    <div class="form-check form-switch m-2 mb-4">
                        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                        <label class="form-check-label header" for="flexSwitchCheckDefault">Allow gift wrapping </label>
                        <small class="form-check-label" for="flexSwitchCheckDefault">Allow product to gift wrapping</small>
                        <small class="form-check-label warning" for="flexSwitchCheckDefault"><ion-icon name="warning-outline"></ion-icon>Product should be</small>
                    </div>
                    <div class="form-check form-switch m-2 mb-4">
                        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                        <label class="form-check-label header" for="flexSwitchCheckDefault">Allow installment</label>
                        <small class="form-check-label" for="flexSwitchCheckDefault">Allow product to show installment badge</small>
                        <small class="form-check-label warning" for="flexSwitchCheckDefault"><ion-icon name="warning-outline"></ion-icon>Product should be</small>
                    </div>
                    <div class="form-check form-switch m-2 mb-4">
                        <input class="form-check-input" checked type="checkbox" role="switch" id="flexSwitchCheckDefault">
                        <label class="form-check-label header" for="flexSwitchCheckDefault">Enabled on Chanel CDS </label>
                        <small class="form-check-label" for="flexSwitchCheckDefault">Set status enabled on channel of product default as enabled on CDS</small>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-check form-switch m-2 mb-4">
                        <input class="form-check-input" checked type="checkbox" role="switch" id="flexSwitchCheckDefault">
                        <label class="form-check-label header" for="flexSwitchCheckDefault">Can Return</label>
                        <small class="form-check-label" for="flexSwitchCheckDefault">Set status enabled on channel of product default as enabled on CDS</small>
                        <small class="form-check-label warning" for="flexSwitchCheckDefault"><ion-icon name="warning-outline"></ion-icon>Product should be</small>
                    </div>
                    <div class="form-check form-switch m-2 mb-4">
                        <input class="form-check-input" checked type="checkbox" role="switch" id="flexSwitchCheckDefault">
                        <label class="form-check-label header" for="flexSwitchCheckDefault">Can Exchange</label>
                        <small class="form-check-label" for="flexSwitchCheckDefault">Set status enabled on channel of product default as enabled on CDS</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 bg-white" style="padding-top:80px;padding-left:50px">
        <div class="d-flex bd-highlight" >
            <div class="p-2 flex-grow-1 bd-highlight" style="place-self: center;">
                <div style="font-size:24px;" class="header-product-grouping">
                    Convert to PIM template
                </div>
            </div>
            <div class="p-2 bd-highlight">
                <button type="button" class="btn btn-dark" onclick="handleFileChange()" style="width: 242px;text-align-last: left;font-weight: 500;">
                    <div class="d-flex bd-highlight" >
                        <div class="p-2 flex-grow-1 bd-highlight">
                             <span>Start Convert</span>
                        </div>
                        <div class="p-2 bd-highlight">
                            <ion-icon name="play-forward-outline" style="font-size: 25px;"></ion-icon>
                        </div>
                    </div>
                </button>
            </div>
          </div>

            <!-- layer change -->
            <div id="convert_running">
                    File name
            </div>
            <div id="convert_logs" class="border-1">
                Logs convert
        </div>


    </div>
</div>


<script>
    $("#nav_choose_file").load('page/linesheet/asset/nav_choose_file.html');

    function summary_parent_sku_range(){

        parent_prefix = document.getElementById("parent_prefix").value
        parent_bu = document.getElementById("parent_bu").value
        parent_us_id = document.getElementById("parent_us_id").value
        parent_year = document.getElementById("parent_year").value
        parent_month = document.getElementById("parent_month").value
        parent_running = document.getElementById("parent_running").value

        parent_sku_display =parent_prefix+parent_bu+parent_us_id+parent_year+parent_month+parent_running
        document.getElementById("preview_parent_start").innerText = parent_sku_display

    }

    var XLSX = require('xlsx');
    var { PythonShell } = require('python-shell');
    var os = require('os');
    var path = require('path');
    var fs = require('fs');

  // Function to handle file input change
//   document.getElementById('linesheet_input').files[0] = sessionStorage.getItem('linesheet_file_path');

    function handleFileChange() {
      console.log('call handleFileChange');
    //   const file = event.target.files[0];
    //   const file= sessionStorage.getItem('linesheet_file_path')
    //   const reader = new FileReader();

    //   reader.onload = function (e) {
        // const data = new Uint8Array(e.target.result);
        const file= sessionStorage.getItem('linesheet_file_path')
        // const workbook = XLSX.read(data, { type: 'array' });
        const workbook = XLSX.readFile(file);
        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
        let jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 0 ,defval: ''});

        // Remove rows 2 to 11
        jsonData.splice(0, 11);

        jsonData = jsonData.filter(row => row['ibc'] !== '');
       // Find the columns to delete


        // const columnsToDelete = Object.keys(jsonData[0]).filter(key => key.startsWith('__EMPTY'));

        // Remove the columns from each row in the jsonData
        jsonData = jsonData.map(row => {
        // columnsToDelete.forEach(column => {
        //     delete row[column];
        // });

        return row;
        });

        console.log('Excel file converted to JSON:');
        console.log(jsonData);

        // Convert JSON to string
        const jsonString = JSON.stringify(jsonData);

        // Create a JSON file in the temporary directory
        const tempDir = os.tmpdir();
        const filePath = path.join(tempDir, 'temp_spear_convert.json');
        fs.writeFileSync(filePath, jsonString);



        new PythonShell(`src/page/linesheet/convertor/main.py`, { args: [filePath]}  )
        .on('error', err => {console.error('An error occurred while running the Python script:', err);})
        .on('stderr', message => {
            console.error('Received error message:', message);
        })
        .on('message', message => {
            document.getElementById('convert_logs').innerHTML = document.getElementById('convert_logs').innerHTML +'</br>'+ message


            // Remove the temporary directory
            // fs.rmdir(filePath, { recursive: true }, (err) => {
            // if (err) {
            //     console.error(`Error removing temporary directory: ${err}`);
            // } else {
            //     console.log('Temporary directory removed successfully');
            // }
            // });
        });
    //   };

    //   reader.readAsArrayBuffer(file);
    }

</script>


